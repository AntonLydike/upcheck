<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UpCheck - Uptime Check Tool</title>
  <style>
    .histogram {
      display: flex;
      align-items: flex-end;
      height: 4rem;
      gap: 3px;
      margin-top: 0.5rem;
    }
    .bar {
      flex: 1;
      border-radius: 3px;
      height: calc(var(--size, 1) * 100%);
    }
    .bar.gray   { background-color: #dadddf; } /* no data */
    .bar.green  { background-color: #28a745; } /* good */
    .bar.orange { background-color: #fd7e14; } /* warning */
    .bar.red    { background-color: #dc3545; } /* critical */
    .bi {
        line-height: 1;
        vertical-align: -.125em;
    }
    @media (max-width: 800px) {
        .histogram {
            gap: 0;
        }
        .bar {
            border-radius: 0px;
        }
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>
<body class="bg-light">
<div class="container py-5">

  <h1 class="mb-4">Service Uptime Dashboard</h1>

  {% for name, service in data.items() %}
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h3 class="card-title">
        {{ name }}
        <a href="{{ service.url }}" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
            <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
        </svg>
        </a>
      </h3>

      <!-- Uptime Histogram -->
      <h6 class="mt-3">Uptime</h6>
      <div class="histogram">
        {% for up in service.hist %}
          {% if up != up %}
            <div class="bar gray" title="No Data"></div>
          {% else %}
            {% if up < service.uptime_goal %}
              <div class="bar red" style="--size: {{up}}" title="Below goal: {{ '%.0f'|format(up*100) }}%"></div>
            {% elif up < 1 %}
              <div class="bar orange" style="--size: {{up}}" title="Degraded: {{ '%.0f'|format(up*100) }}%"></div>
            {% else %}
              <div class="bar green" style="--size: {{up}}" title="Good: {{ '%.0f'|format(up*100) }}%"></div>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>

      <!-- Latency Histogram -->
      <h6 class="mt-4">Latency (geomean)</h6>
      <div class="histogram">
        {% for lat, time in service.hist_latency|zip(time_buckets) %}
          {% if lat != lat %}
            <div class="bar gray" title="No Data"></div>
          {% else %}
            {% if lat > 2 * service.degraded_latency %}
              <div class="bar red" style="--size: {{lat / service.max_geomean_lat}}" x-time="{{time}}" x-value="{{lat|round(3)}}s" title="{{time}}: {{ lat|round(3) }}s"></div>
            {% elif lat > service.degraded_latency %}
              <div class="bar orange" style="--size: {{lat / service.max_geomean_lat}}" x-time="{{time}}" x-value="{{lat|round(3)}}s" title="{{time}}: {{ lat|round(3) }}s"></div>
            {% else %}
              <div class="bar green" style="--size: {{lat / service.max_geomean_lat}}" x-time="{{time}}" x-value="{{lat|round(3)}}s" title="{{time}}: {{ lat|round(3) }}s"></div>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>

      <div class="d-flex justify-content-between">
          <div class="text-muted"><time datetime="{{ start_time }}">{{ start_time }}</time></div>
          <div class="text-muted"><time datetime="{{ end_time }}">{{ end_time }}</time></div>
      </div>

      <!-- Stats -->
      <div class="mt-4 d-flex justify-content-between">
        <p class=""><strong>Uptime (recent):</strong> {{ '%.2f'|format(service.uptime * 100) }}%</p>
        <p class=""><strong>Total Uptime:</strong> {{ '%.2f'|format(service.total_uptime * 100) }}%</p>
        <p class=""><strong>Goal:</strong> >{{ '%.2f'|format(service.uptime_goal * 100) }}%</p>
      </div>
    </div>
  </div>
  {% endfor %}

  <footer class="text-muted mt-5 d-flex justify-content-between">
    <small>&copy; Copyright 2025 - Anton Lydike</small>
    <small>Powered by <a href="https://github.com/antonlydike/upcheck">UpCheck</a></small>
  </footer>
  </div>
  <script>document.querySelectorAll('time[datetime]').forEach(t => {
    t.innerText = (new Date(t.getAttribute('datetime'))).toLocaleString();
  })</script>
  </body>
  </html>